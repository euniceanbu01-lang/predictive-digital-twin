<!DOCTYPE html>
<html>
<head>

  <title>Leak Digital Twin</title>

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>

  <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>

</head>

<body>

<div id="cesiumContainer"></div>

<script>

const viewer = new Cesium.Viewer("cesiumContainer");

// Your local API
const API = "http://127.0.0.1:8000/predict";

// Example location (change later)
const lon = 78.4867;
const lat = 17.3850;

// Get prediction
fetch(API + "?pressure=40&flow=20")
.then(res => res.json())
.then(data => {

  let color = Cesium.Color.GREEN;

  if (data.probability > 0.6)
      color = Cesium.Color.RED;
  else if (data.probability > 0.3)
      color = Cesium.Color.YELLOW;

  // Add marker
  viewer.entities.add({

    position: Cesium.Cartesian3.fromDegrees(lon, lat),

    point: {
      pixelSize: 16,
      color: color
    },

    label: {
      text: "Leak Status",
      scale: 0.6,
      verticalOrigin: Cesium.VerticalOrigin.BOTTOM
    },

    description: `
      <b>Pressure:</b> ${data.pressure}<br>
      <b>Flow:</b> ${data.flow}<br>
      <b>Probability:</b> ${data.probability}<br>
      <b>Leak:</b> ${data.leak}
    `
  });

  viewer.flyTo(viewer.entities);

});

</script>

</body>
</html>
